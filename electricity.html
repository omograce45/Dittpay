<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DitPay - Pay Electricity</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Pay Electricity Bill</h1>
    <nav>
      <a href="dashboard.html">Home</a>
      <a href="wallet.html">Wallet</a>
      <a href="transactions.html">Transactions</a>
      <a href="profile.html">Profile</a>
    </nav>
  </header>

  <main class="content">
    <div class="container">
      <h2>Electricity Bill Payment</h2>

      <form id="electricityForm">
        <label for="meter">Meter Number:</label><br>
        <input type="text" id="meter" placeholder="1234567890" required /><br><br>

        <label for="disco">DisCo Provider:</label><br>
        <select id="disco" required>
          <option value="">-- Choose Provider --</option>
          <option value="01">Eko Electric - EKEDC</option>
          <option value="02">Ikeja Electric - IKEDC</option>
          <option value="03">Abuja Electric - AEDC</option>
          <option value="04">Kano Electric - KEDC</option>
          <option value="05">Port Harcourt Electric - PHEDC</option>
          <option value="06">Jos Electric - JEDC</option>
          <option value="07">Ibadan Electric - IBEDC</option>
          <option value="08">Kaduna Electric - KAEDC</option>
          <option value="09">Enugu Electric - EEDC</option>
          <option value="10">Benin Electric - BEDC</option>
          <option value="11">Yola Electric - YEDC</option>
          <option value="12">Aba Electric - APLE</option>
        </select><br><br>

        <label for="meterType">Meter Type:</label><br>
        <select id="meterType" required>
          <option value="">-- Select Type --</option>
          <option value="01">Prepaid</option>
          <option value="02">Postpaid</option>
        </select><br><br>

        <label for="phone">Phone Number:</label><br>
        <input type="text" id="phone" placeholder="08012345678" required /><br><br>

        <label for="amount">Amount (‚Ç¶):</label><br>
        <input type="number" id="amount" min="500" required /><br><br>

        <button type="button" onclick="verifyMeter()">üîé Verify Meter</button>
        <button type="submit">üí° Pay Electricity</button>
      </form>

      <div id="verifyResult" style="margin-top:15px; font-weight:bold;"></div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 DitPay. All Rights Reserved.</p>
  </footer>

  <script>
    const API_BASE = "https://dit-pay.onrender.com";

    async function verifyMeter() {
      const meter = document.getElementById("meter").value.trim();
      const disco = document.getElementById("disco").value;

      if (!meter || !disco) {
        alert("‚ö†Ô∏è Enter Meter Number and DisCo before verifying.");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/verify-meter?meter=${meter}&disco=${disco}`, {
          method: "GET",
          headers: {
            "Authorization": "Bearer " + localStorage.getItem("token")
          }
        });

        const data = await res.json();
        if (res.ok) {
          document.getElementById("verifyResult").innerText = `‚úÖ Verified: ${data.customer_name}`;
        } else {
          document.getElementById("verifyResult").innerText = `‚ùå ${data.message}`;
        }
      } catch (err) {
        document.getElementById("verifyResult").innerText = "‚ùå Error: " + err.message;
      }
    }

    document.getElementById("electricityForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const meter = document.getElementById("meter").value.trim();
      const disco = document.getElementById("disco").value;
      const meterType = document.getElementById("meterType").value;
      const phone = document.getElementById("phone").value.trim();
      const amount = document.getElementById("amount").value;

      if (!meter || !disco || !meterType || !phone || !amount) {
        alert("‚ö†Ô∏è Please fill all fields.");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/pay-electricity?meter=${meter}&disco=${disco}&meterType=${meterType}&phone=${phone}&amount=${amount}`, {
          method: "GET",
          headers: {
            "Authorization": "Bearer " + localStorage.getItem("token")
          }
        });

        const data = await res.json();
        if (res.ok) {
          alert(`‚úÖ ${data.message}\nNew Balance: ‚Ç¶${data.new_balance}`);
        } else {
          alert(`‚ùå ${data.message}`);
        }
      } catch (err) {
        alert("‚ùå Error: " + err.message);
      }
    });
  </script>
</body>
                                                 </html>
